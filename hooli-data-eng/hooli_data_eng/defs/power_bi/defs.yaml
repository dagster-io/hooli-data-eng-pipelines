type: dagster_powerbi.PowerBIWorkspaceComponent

attributes:
  workspace:
    credentials:
      client_id: "{{ env('AZURE_POWERBI_CLIENT_ID') }}"
      client_secret: "{{ env('AZURE_POWERBI_CLIENT_SECRET') }}"
      tenant_id: "{{ env('AZURE_POWERBI_TENANT_ID') }}"
    workspace_id: "{{ env('AZURE_POWERBI_WORKSPACE_ID') }}"

  enable_semantic_model_refresh: true

  translation:
    group_name: "BI"
    for_report:
      description: "Report link: https://app.powerbi.com/groups/{{ env.AZURE_POWERBI_WORKSPACE_ID }}/reports/{{ data.properties['id'] }}"
      tags:
        core_kpis: ''
    for_semantic_model:
      description: "Semantic model link: https://app.powerbi.com/groups/{{ env.AZURE_POWERBI_WORKSPACE_ID }}/datasets/{{ data.properties['id'] }}/details"
      deps: >-
        {%- set upstream_deps = [] -%}
        {%- for dep in spec.deps -%}
          {%- set parts = dep.asset_key.path -%}
          {%- set new_key = [parts[1] | upper] + parts[2:] -%}
          {%- set _ = upstream_deps.append(new_key) -%}
        {%- endfor -%}
        {{ upstream_deps }}
      tags:
        core_kpis: ''
    for_data_source:
      key_prefix: 'ANALYTICS'

requirements:
  env:
    - AZURE_POWERBI_CLIENT_ID
    - AZURE_POWERBI_CLIENT_SECRET
    - AZURE_POWERBI_TENANT_ID
    - AZURE_POWERBI_WORKSPACE_ID
